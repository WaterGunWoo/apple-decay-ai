<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Í≥ºÏùº Î∂ÄÌå® ÌåêÎ≥ÑÍ∏∞</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            background-color: #ffffff;
            color: #191f28;
        }

        .container {
            width: 100%;
            max-width: 720px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background-color: #ffffff;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #f2f4f6;
        }

        nav {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .logo {
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .logo h1 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #191f28;
            text-decoration: none;
            margin: 0;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            color: #8b95a1;
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 500;
            padding: 0.5rem 0;
            transition: color 0.2s ease;
        }

        .nav-links a:hover {
            color: #191f28;
        }

        .nav-links a.active {
            color: #191f28;
            font-weight: 600;
        }

        main {
            min-height: calc(100vh - 160px);
            padding: 2rem 0;
        }

        .content-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
        }

        .content-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #333d4b;
        }

        .intro-section {
            text-align: center;
            margin-bottom: 2.5rem;
            background-color: #ffffff;
            border: 1px solid #f2f4f6;
            border-radius: 14px;
            padding: 1.5rem;
        }

        .intro-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #191f28;
            margin-bottom: 0.75rem;
            letter-spacing: -0.03em;
            line-height: 1.3;
        }

        .intro-section p {
            color: #8b95a1;
            font-size: 1.125rem;
            margin-bottom: 0;
            font-weight: 400;
        }

        .section-block {
            text-align: left;
            background-color: #ffffff;
            border: 1px solid #f2f4f6;
            border-radius: 14px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .section-block h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #191f28;
            margin-bottom: 0.75rem;
            letter-spacing: -0.03em;
            line-height: 1.3;
        }

        .section-block p {
            color: #8b95a1;
            font-size: 1.125rem;
            margin-bottom: 1.5rem;
            font-weight: 400;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .feature-item {
            padding: 1.5rem;
            background-color: #f9fafb;
            border-radius: 12px;
            border: 1px solid #e5e8eb;
        }

        .feature-item h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333d4b;
            margin-bottom: 0.5rem;
        }

        .feature-item p {
            color: #6b7684;
            font-size: 0.875rem;
        }

        .upload-section {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .upload-section:hover {
            border-color: #3182f6;
        }

        .upload-section.dragover {
            border-color: #3182f6;
            background-color: rgba(49, 130, 246, 0.05);
        }

        .upload-section h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #191f28;
            margin-bottom: 0.75rem;
            letter-spacing: -0.03em;
            line-height: 1.3;
        }

        .upload-section p {
            color: #8b95a1;
            font-size: 1.125rem;
            margin-bottom: 1.5rem;
            font-weight: 400;
        }

        .upload-button {
            background-color: #3182f6;
            color: white;
            border: none;
            padding: 0.875rem 1.5rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .upload-button:hover {
            background-color: #1b64da;
        }

        #fileInput {
            display: none;
        }

        .preview-section {
            display: none;
            text-align: left;
            background-color: #f9fafb;
            border: 1px solid #eef0f3;
            border-radius: 14px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .preview-section img {
            width: 100%;
            height: auto;
            max-height: 400px;
            object-fit: contain;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .result-section {
            display: none;
            background-color: #f9fafb;
            border: 1px solid #eef0f3;
            border-radius: 14px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .result-section h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #191f28;
            margin-bottom: 0.75rem;
            letter-spacing: -0.03em;
            line-height: 1.3;
        }

        .result-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .result-card {
            padding: 1.25rem;
            background-color: #f9fafb;
            border-radius: 12px;
            border: 1px solid #e5e8eb;
        }

        .result-card h3 {
            font-size: 1rem;
            font-weight: 600;
            color: #6b7684;
            margin-bottom: 0.5rem;
        }

        .result-card p {
            font-size: 1.25rem;
            font-weight: 700;
            color: #333d4b;
        }

        .retry-button {
            background-color: #ffffff;
            color: #191f28;
            border: 1px solid #f2f4f6;
            padding: 0.875rem 1.5rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            margin-top: 1rem;
        }

        .retry-button:hover {
            background-color: #f9fafb;
            border-color: #e1e4e8;
        }

        footer {
            background-color: white;
            color: #6b7684;
            text-align: center;
            padding: 1.5rem 0;
            font-size: 0.875rem;
            border-top: 1px solid #e5e8eb;
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            .features {
                grid-template-columns: 1fr;
            }
            
            .content-section h1 {
                font-size: 2rem;
            }

            .intro-section h1,
            .upload-section h2 {
                font-size: 2rem;
            }

            .intro-section p,
            .upload-section p {
                font-size: 1rem;
            }

            .upload-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <a href="index.html" class="logo"><h1>Í≥ºÏùº ÎÇ¥Î∂Ä  Î∂ÄÌå® ÌåêÎ≥ÑÍ∏∞ üçé</h1></a>
            </nav>
        </div>
    </header>

    <main>
        <div class="container">
            <section class="content-section">
                <div class="intro-section">
                    <h1>CNN Î™®Îç∏ Í∏∞Î∞ò ÏÇ¨Í≥º ÎÇ¥Î∂Ä Î∂ÄÌå® ÌåêÎ≥Ñ</h1>
                    <p>Ï†ÅÏô∏ÏÑ† Ïù¥ÎØ∏ÏßÄÎ•º ÌÜµÌï¥ ÏÇ¨Í≥ºÏùò ÎÇ¥Î∂Ä Î∂ÄÌå®Î•º ÌåêÎã®Ìï©ÎãàÎã§</p>
                </div>

                <div id="uploadSection" class="section-block upload-section">
                    <h1>Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú</h1>
                    <p>Î∂ÑÏÑùÌïòÍ≥† Ïã∂ÏùÄ ÏÇ¨Í≥ºÏùò Ï†ÅÏô∏ÏÑ† Ïù¥ÎØ∏ÏßÄÎ•º ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî</p>
                    <input type="file" id="fileInput" accept="image/*">
                    <button class="upload-button">Ïù¥ÎØ∏ÏßÄ ÏÑ†ÌÉù</button>
                </div>

                <div id="previewSection" class="section-block preview-section">
                    <h1>ÏóÖÎ°úÎìúÎêú Ïù¥ÎØ∏ÏßÄ</h1>
                    <img id="previewImage" src="#" alt="ÏÑ†ÌÉùÎêú Ïù¥ÎØ∏ÏßÄ">
                </div>

                <div id="resultSection" class="section-block result-section">
                    <h1>Î∂ÑÏÑù Í≤∞Í≥º</h1>
                    <div id="resultContent">
                        <!-- Î∂ÑÏÑù Í≤∞Í≥ºÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                        <p id="resultText"></p>
                        <p id="confidenceText"></p>
                    </div>
                    <button class="retry-button">Îã§Ïãú ÌåêÎ≥ÑÌï¥Î≥¥Í∏∞</button>
                </div>
            </section>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>Í≥ºÏùº ÎÇ¥Î∂Ä Î∂ÄÌå® ÌåêÎ≥Ñ Î™®Îç∏ ¬© 2025 ÏÉÅÎÇ®Ïûê ÌÅ¥ÎüΩ</p>
        </div>
    </footer>

    <script>
        let model;
        const MODEL_PATH = 'tfjs_model/model.json';
        // SavedModel exportÏãú ÌôïÏù∏Ìïú ÏûÖÎ†• ÌÖêÏÑú Ïù¥Î¶Ñ (Î™®Îç∏ Íµ¨Ï°∞Ïóê Îî∞Îùº Îã§Î•º Ïàò ÏûàÏùå)
        // SavedModel export Î°úÍ∑∏ÏóêÏÑú ÌôïÏù∏Ìïú ÏûÖÎ†• ÌÖêÏÑú Ïù¥Î¶Ñ: 'input_layer_3'
        const INPUT_TENSOR_NAME = 'input_layer_3'; 
        // SavedModel exportÏãú Ï∂úÎ†• ÌÖêÏÑú Ïù¥Î¶Ñ (Ï£ºÎ°ú 'Identity' ÎòêÎäî ÎßàÏßÄÎßâ Î†àÏù¥Ïñ¥ Ïù¥Î¶Ñ, Î™®Îç∏ Íµ¨Ï°∞Ïóê Îî∞Îùº Îã§Î•º Ïàò ÏûàÏùå)
        // SavedModel export Î°úÍ∑∏ÏóêÏÑú Î™ÖÌôïÌûà ÌôïÏù∏ÎêòÏßÄ ÏïäÏïòÏúºÎØÄÎ°ú Í∏∞Î≥∏Í∞íÏù∏ 'Identity'Î°ú ÏãúÎèÑ
        const OUTPUT_TENSOR_NAME = 'Identity'; 

        // Î™®Îç∏ Î°úÎìú (Graph Model ÏÇ¨Ïö©)
        async function loadModel() {
            try {
                // tf.loadLayersModel ÎåÄÏã† tf.loadGraphModel ÏÇ¨Ïö©
                console.log('Î™®Îç∏ Î°úÎìú Ï§ë...', MODEL_PATH);
                model = await tf.loadGraphModel(MODEL_PATH);
                console.log('Î™®Îç∏ Î°úÎìú ÏôÑÎ£å');
                 // Î™®Îç∏Ïùò ÏûÖÏ∂úÎ†• Ï†ïÎ≥¥ ÌôïÏù∏ (ÏÑ†ÌÉù ÏÇ¨Ìï≠)
                 console.log('Î™®Îç∏ ÏûÖÎ†• ÌÖêÏÑú:', model.inputs);
                 console.log('Î™®Îç∏ Ï∂úÎ†• ÌÖêÏÑú:', model.outputs);
            } catch (error) {
                console.error('Î™®Îç∏ Î°úÎìú Ïã§Ìå®:', error);
                alert('Î™®Îç∏ Î°úÎìúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî.\nÏò§Î•ò: ' + error.message);
            }
        }

        // Ïù¥ÎØ∏ÏßÄ Ï†ÑÏ≤òÎ¶¨
        function preprocessImage(imageElement) {
            return tf.tidy(() => {
                // Ïù¥ÎØ∏ÏßÄÎ•º ÌÖêÏÑúÎ°ú Î≥ÄÌôò
                // Î™®Îç∏ ÏûÖÎ†• ÌòïÌÉú (None, 224, 224, 1)Ïóê ÎßûÍ≤å Ï±ÑÎÑê 1 (ÌùëÎ∞±)ÏúºÎ°ú Î≥ÄÌôò
                let tensor = tf.browser.fromPixels(imageElement, 1) 
                    .resizeNearestNeighbor([224, 224]) // Î™®Îç∏ ÏûÖÎ†• ÌÅ¨Í∏∞Ïóê ÎßûÍ≤å Ï°∞Ï†ï
                    .toFloat()
                    .div(tf.scalar(255.0)) // Ï†ïÍ∑úÌôî
                    .expandDims();
                return tensor;
            });
        }

        // Ïù¥ÎØ∏ÏßÄ ÏòàÏ∏° (Graph Model ÏÇ¨Ïö©)
        async function predictImage(imageElement) {
             if (!model) {
                alert('Î™®Îç∏Ïù¥ Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            try {
                // Ïù¥ÎØ∏ÏßÄ Ï†ÑÏ≤òÎ¶¨
                const tensor = preprocessImage(imageElement);

                // ÏòàÏ∏° (Graph ModelÏóêÏÑúÎäî executeAsync ÎòêÎäî execute ÏÇ¨Ïö©)
                // executeAsyncÎäî ÏûÖÎ†• ÌÖêÏÑúÏùò Î∞∞Ïó¥, Ï∂úÎ†• ÌÖêÏÑú Ïù¥Î¶ÑÏùò Î∞∞Ïó¥ÏùÑ Î∞õÏùå
                // ÏûÖÎ†• ÌÖêÏÑú Ïù¥Î¶ÑÏùÄ INPUT_TENSOR_NAMEÏùÑ ÏÇ¨Ïö©
                const predictionResult = await model.executeAsync({[INPUT_TENSOR_NAME]: tensor}, OUTPUT_TENSOR_NAME);

                // Í≤∞Í≥º (Ï∂úÎ†• ÌÖêÏÑú Î∞∞Ïó¥ÏóêÏÑú Ï≤´ Î≤àÏß∏ Í≤∞Í≥º Í∞ÄÏ†∏Ïò¥)
                // Graph ModelÏùò executeAsync Í≤∞Í≥ºÎäî ÌÖêÏÑú Î∞∞Ïó¥Ïù¥ÎØÄÎ°ú Ï≤´ Î≤àÏß∏ ÌÖêÏÑúÏùò Í∞íÏùÑ Í∞ÄÏ†∏Ïò¥
                const probability = predictionResult.dataSync()[0]; 

                // Í≤∞Í≥º Ìï¥ÏÑù
                const isRotten = probability > 0.5;
                const confidence = isRotten ? probability : 1 - probability;
                const accuracy = probability * 100;

                // Í≤∞Í≥º ÌëúÏãú
                const resultSection = document.querySelector('.result-section');
                const resultText = document.getElementById('resultText');
                const confidenceText = document.getElementById('confidenceText');

                resultSection.style.display = 'block';
                resultText.textContent = isRotten ? "ÎÇ¥Î∂ÄÍ∞Ä Î∂ÄÌå®Ìïú ÏÇ¨Í≥ºÏûÖÎãàÎã§." : "Ïã†ÏÑ†Ìïú ÏÇ¨Í≥ºÏûÖÎãàÎã§.";
                confidenceText.textContent = `Ï†ïÌôïÎèÑ: ${accuracy.toFixed(2)}%`;

                // ÌÖêÏÑú Î©îÎ™®Î¶¨ Ìï¥Ï†ú
                tensor.dispose();
                predictionResult.dispose(); // ÏòàÏ∏° Í≤∞Í≥º ÌÖêÏÑúÎèÑ Ìï¥Ï†ú

            } catch (error) {
                console.error('ÏòàÏ∏° Ï§ë Ïò§Î•ò Î∞úÏÉù:', error);
                alert('Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.\nÏò§Î•ò: ' + error.message);
            }
        }

        // ÌååÏùº ÏûÖÎ†• Ï≤òÎ¶¨
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        // Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞
                        const previewSection = document.querySelector('.preview-section');
                        const previewImage = document.getElementById('previewImage');
                        previewImage.src = event.target.result;
                        previewSection.style.display = 'block';

                        // Ïù¥ÎØ∏ÏßÄ ÏòàÏ∏°
                        predictImage(img);
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // 'Ïù¥ÎØ∏ÏßÄ ÏÑ†ÌÉù' Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú ÌååÏùº ÏûÖÎ†• Ìä∏Î¶¨Í±∞
        document.querySelector('.upload-button').addEventListener('click', function() {
            document.getElementById('fileInput').click();
        });

        // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Ï≤òÎ¶¨
        const uploadSection = document.querySelector('.upload-section');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadSection.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadSection.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadSection.addEventListener(eventName, unhighlight, false);
        });

        function highlight(e) {
            uploadSection.classList.add('dragover');
        }

        function unhighlight(e) {
            uploadSection.classList.remove('dragover');
        }

        uploadSection.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const file = dt.files[0];

            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        // Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞
                        const previewSection = document.querySelector('.preview-section');
                        const previewImage = document.getElementById('previewImage');
                        previewImage.src = event.target.result;
                        previewSection.style.display = 'block';

                        // Ïù¥ÎØ∏ÏßÄ ÏòàÏ∏°
                        predictImage(img);
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Î™®Îç∏ Î°úÎìú
        window.onload = loadModel;
    </script>
</body>
</html>
